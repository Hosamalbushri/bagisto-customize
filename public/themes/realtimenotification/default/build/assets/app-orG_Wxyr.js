const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["/themes/realTimeNotification/default/build/assets/index.esm-CfqK_NY8.js","/themes/realTimeNotification/default/build/assets/index.esm2017-esY-VeE4.js","/themes/realTimeNotification/default/build/assets/index.esm-DKpBG9ec.js","/themes/realTimeNotification/default/build/assets/index.esm2017-CHlhhcbP.js","/themes/realTimeNotification/default/build/assets/index.esm-hLbReo1A.js"])))=>i.map(i=>d[i]);
const b="modulepreload",y=function(l,e){return new URL(l,e).href},h={},p=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){const n=document.getElementsByTagName("link"),s=document.querySelector("meta[property=csp-nonce]"),d=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));o=Promise.allSettled(t.map(r=>{if(r=y(r,i),r in h)return;h[r]=!0;const u=r.endsWith(".css"),w=u?'[rel="stylesheet"]':"";if(!!i)for(let f=n.length-1;f>=0;f--){const g=n[f];if(g.href===r&&(!u||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${w}`))return;const c=document.createElement("link");if(c.rel=u?"stylesheet":b,u||(c.as="script"),c.crossOrigin="",c.href=r,d&&c.setAttribute("nonce",d),document.head.appendChild(c),u)return new Promise((f,g)=>{c.addEventListener("load",f),c.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${r}`)))})}))}function a(n){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=n,window.dispatchEvent(s),!s.defaultPrevented)throw n}return o.then(n=>{for(const s of n||[])s.status==="rejected"&&a(s.reason);return e().catch(a)})};class m{constructor(){this.firebaseApp=null,this.analytics=null,this.messaging=null,this.config=null,this.vapidKey=null,this.isInitialized=!1,this.init()}async init(){try{if(this.config=window.firebaseConfig||null,this.vapidKey=window.firebaseVapidKey||null,!this.config){console.warn("Firebase config not found");return}await this.initializeFirebase(),await this.setupServiceWorker(),await this.setupMessaging(),this.isInitialized=!0,console.log("✅ Firebase Notification App initialized successfully")}catch(e){console.error("❌ Firebase Notification App initialization error:",e)}}async initializeFirebase(){try{const{initializeApp:e}=await p(async()=>{const{initializeApp:o}=await import("./index.esm-CfqK_NY8.js");return{initializeApp:o}},__vite__mapDeps([0,1]),import.meta.url),{getAnalytics:t}=await p(async()=>{const{getAnalytics:o}=await import("./index.esm-DKpBG9ec.js");return{getAnalytics:o}},__vite__mapDeps([2,1,3]),import.meta.url),{getMessaging:i}=await p(async()=>{const{getMessaging:o}=await import("./index.esm-hLbReo1A.js");return{getMessaging:o}},__vite__mapDeps([4,3,1]),import.meta.url);this.firebaseApp=e(this.config),this.analytics=t(this.firebaseApp),this.messaging=i(this.firebaseApp),console.log("✅ Firebase initialized successfully with v9+ modular SDK")}catch(e){throw console.error("❌ Firebase initialization error:",e),e}}async setupServiceWorker(){if("serviceWorker"in navigator)try{const e=await navigator.serviceWorker.register(window.serviceWorkerUrl);console.log("✅ Service Worker registered successfully:",e)}catch(e){console.error("❌ Service Worker registration failed:",e)}}async setupMessaging(){if(!this.messaging){console.warn("Messaging not available");return}await this.getFCMToken(),this.setupMessageHandlers()}async getFCMToken(){try{const{getToken:e}=await p(async()=>{const{getToken:i}=await import("./index.esm-hLbReo1A.js");return{getToken:i}},__vite__mapDeps([4,3,1]),import.meta.url),t=await e(this.messaging,{vapidKey:this.vapidKey});t?(console.log("🔑 FCM Token:",t),await this.subscribeToTopic(t)):(console.log("❌ No FCM token available"),await this.requestNotificationPermission())}catch(e){console.error("❌ Error getting FCM token:",e)}}async subscribeToTopic(e){try{const t=this.config.apiKey,i="general-notifications",o=`https://iid.googleapis.com/iid/v1/${e}/rel/${i}/`,a=await fetch(o,{method:"POST",headers:{Authorization:`key=${t}`,"Content-Type":"application/json"}});if(a.ok)console.log("✅ Successfully subscribed to topic:",i);else{const n=await a.text();console.error("❌ Error subscribing to topic:",a.status,n)}}catch(t){throw console.error("❌ Error subscribing to topic:",t),t}}async requestNotificationPermission(){try{if(!this.messaging){console.log("Messaging not available");return}await Notification.requestPermission()==="granted"?(console.log("✅ Notification permission granted"),await this.getFCMToken()):console.log("❌ Notification permission denied")}catch(e){console.error("❌ Error requesting permission:",e)}}async setupMessageHandlers(){try{const{onMessage:e}=await p(async()=>{const{onMessage:t}=await import("./index.esm-hLbReo1A.js");return{onMessage:t}},__vite__mapDeps([4,3,1]),import.meta.url);e(this.messaging,t=>{var i,o;console.log("📨 Message received:",t),this.showNotification(((i=t.notification)==null?void 0:i.title)||"إشعار جديد",((o=t.notification)==null?void 0:o.body)||"لديك إشعار جديد")})}catch(e){console.error("❌ Error setting up message handlers:",e)}}showNotification(e,t){const i=document.createElement("div");i.className="firebase-notification success",i.innerHTML=`
            <button class="close-btn" onclick="this.parentElement.remove()">&times;</button>
            <div class="title">${e}</div>
            <div class="message">${t}</div>
        `,document.body.appendChild(i),setTimeout(()=>{i.parentElement&&i.remove()},5e3)}getCSRFToken(){const e=document.querySelector('meta[name="csrf-token"]');if(e&&e.getAttribute("content"))return e.getAttribute("content");const t=document.querySelector('input[name="_token"]');if(t&&t.value)return t.value;if(window.Laravel&&window.Laravel.csrfToken)return window.Laravel.csrfToken;const i=document.cookie.split(";");for(let o of i){const[a,n]=o.trim().split("=");if(a==="XSRF-TOKEN")return decodeURIComponent(n)}return console.warn("⚠️ CSRF token not found. Please ensure CSRF token is available."),""}async fetchCSRFToken(){try{const e=await fetch("/realtimenotification/csrf-token",{method:"GET",headers:{Accept:"application/json"}});if(e.ok)return(await e.json()).csrf_token||""}catch(e){console.error("❌ Error fetching CSRF token:",e)}return""}async sendCustomNotification(e,t,i={}){try{this.showNotification(e,t)}catch(o){console.error("❌ Error sending custom notification:",o)}}getStatus(){return{isInitialized:this.isInitialized,hasFirebase:!!this.firebaseApp,hasMessaging:!!this.messaging,hasAnalytics:!!this.analytics}}async getSubscriptionStatus(){try{const e=await fetch("/realtimenotification/subscription-status",{method:"GET",headers:{Accept:"application/json","X-CSRF-TOKEN":this.getCSRFToken()}});if(e.ok){const t=await e.json();return console.log("📊 Subscription status:",t),t}else return console.error("❌ Error getting subscription status:",e.statusText),null}catch(e){return console.error("❌ Error getting subscription status:",e),null}}}document.addEventListener("DOMContentLoaded",function(){window.firebaseConfig?(window.firebaseNotificationApp=new m,window.firebaseNotification={show:(l,e)=>window.firebaseNotificationApp.showNotification(l,e),requestPermission:()=>window.firebaseNotificationApp.requestNotificationPermission(),sendCustom:(l,e,t)=>window.firebaseNotificationApp.sendCustomNotification(l,e,t),getStatus:()=>window.firebaseNotificationApp.getStatus(),getSubscriptionStatus:()=>window.firebaseNotificationApp.getSubscriptionStatus(),messaging:()=>window.firebaseNotificationApp.messaging,analytics:()=>window.firebaseNotificationApp.analytics,firebaseApp:()=>window.firebaseNotificationApp.firebaseApp}):console.warn("Firebase config not found. Please ensure firebaseConfig is available in window object.")});typeof module<"u"&&module.exports&&(module.exports=m);
